"use strict";(self["webpackChunkimage_management"]=self["webpackChunkimage_management"]||[]).push([[775],{1873:function(t,e,a){a.d(e,{Z:function(){return c}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"loading-mask"},[e("div",{staticClass:"loading"},[e("i",{staticClass:"loading-icon icon-spinner2"}),t.text?e("div",{staticClass:"loading-text"},[e("span",[t._v(t._s(t.text))])]):t._e()])])},s=[],i={name:"Loading",props:["text"]},o=i,r=a(1001),l=(0,r.Z)(o,n,s,!1,null,"da633444",null),c=l.exports},3060:function(t,e,a){a.r(e),a.d(e,{default:function(){return $}});var n=function(){var t=this,e=t._self._c;return e("div",[e("page-header"),e("main",[e("div",{staticClass:"main-content"},[e("PullToRefresh",{attrs:{onRefresh:t.refresh}},[t._l(t.imageList,(function(a){return e("image-card",{key:a.id,attrs:{"img-src":a.url,"thumbnail-src":a.thumbnailUrl,"image-detail":a},on:{click:t.handleClick}})})),e("InfiniteScroll",{attrs:{loadMore:t.loadMoreData,hasMore:t.hasMore}}),t.loading||t.imageList.length?t._e():e("el-empty",{attrs:{description:"这里空空如也 /(ㄒoㄒ)/~~"}})],2),t.loading?e("Loading",{attrs:{text:"数据加载中..."}}):t._e()],1),e("image-modal",{attrs:{showModal:t.showModal,images:t.imageList,currentIndex:t.currentIndex},on:{"update:showModal":function(e){t.showModal=e},"update:show-modal":function(e){t.showModal=e},"update:currentIndex":function(e){t.currentIndex=e},"update:current-index":function(e){t.currentIndex=e}}})],1)],1)},s=[],i=(a(7658),a(4806)),o=a.n(i),r=function(){var t=this,e=t._self._c;return e("header",{staticClass:"header-container"},[t._m(0),t._m(1),e("div",{staticClass:"header-container__menu"},[e("div",{staticClass:"header-container__menu-button upload-button"},[e("router-link",{attrs:{to:"/image-upload"}},[e("button",[e("i",{staticClass:"upload-button__icon icon-upload3"}),e("span",{staticClass:"upload-button__text"},[t._v("上传图片")])])])],1),e("div",{staticClass:"header-container__menu-button nav-button"},[e("router-link",{attrs:{to:"/admin"}},[e("button",[t._v("后台管理")])])],1)])])},l=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header-container__logo"},[e("img",{attrs:{src:a(2781)}})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"header-container__title"},[e("span",[t._v("图片展示")])])}],c={name:"PageHeader"},h=c,u=a(1001),d=(0,u.Z)(h,r,l,!1,null,"b2678172",null),f=d.exports,g=function(){var t=this,e=t._self._c;return e("div",{staticClass:"image-card"},[e("div",{staticClass:"image-card__img",style:t.imgStyle,on:{click:t.handleClick}})])},m=[],p={name:"ImageCard",props:["img-src","thumbnail-src","image-detail"],computed:{imgStyle(){return{background:`url(${this.thumbnailSrc}) no-repeat center/cover`}}},methods:{handleClick(){this.$emit("click",this.imageDetail)}}},_=p,v=(0,u.Z)(_,g,m,!1,null,"3d693a88",null),C=v.exports,x=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pull-to-refresh",style:t.style,on:{touchstart:function(e){return e.stopPropagation(),t.onTouchStart.apply(null,arguments)},touchmove:function(e){return e.stopPropagation(),t.onTouchMove.apply(null,arguments)},touchend:function(e){return e.stopPropagation(),t.onTouchEnd.apply(null,arguments)}}},[e("div",{staticClass:"refresh-indicator"},[t._v(" "+t._s(t.refreshText)+" ")]),e("div",{staticClass:"content"},[t._t("default")],2)])},y=[],b={name:"PullToRefresh",props:{onRefresh:{type:Function,default:()=>{}}},data(){return{refreshText:"下拉刷新",startY:"",currentY:0,offset:0}},computed:{style(){return{transform:`translateY(${this.offset}px)`}}},methods:{onTouchStart(t){this.startY=t.touches[0].pageY},onTouchMove(t){const e=document.documentElement.scrollTop;if(e>0)return;this.currentY=t.touches[0].pageY;const a=this.currentY-this.startY;this.offset=.6*a,this.refreshText=a>50?"释放刷新":"下拉刷新"},async onTouchEnd(){this.currentY-this.startY>50?(this.offset=50,this.refreshText="加载中...",await this.onRefresh(),setTimeout((()=>{this.reset()}),800)):this.reset()},reset(){this.refreshText="下拉刷新",this.offset=0}}},M=b,w=(0,u.Z)(M,x,y,!1,null,"2307473c",null),T=w.exports,I=function(){var t=this,e=t._self._c;return e("div",{staticClass:"infinite-scroll"},[t.hasMore?t._e():e("div",[t._v("没有更多了")]),t.hasMore&&t.loading?e("div",{staticClass:"infinite-scroll__loader"}):t._e()])},k=[],S={name:"InfiniteScroll",props:{loadMore:{type:Function,required:!0},threshold:{type:Number,default:30},hasMore:{type:Boolean,required:!0}},data(){return{loading:!1,handleScrollThrottle:null}},mounted(){this.handleScrollThrottle=o().throttle(this.handleScroll,200),window.addEventListener("scroll",this.handleScrollThrottle)},beforeDestroy(){window.removeEventListener("scroll",this.handleScrollThrottle)},methods:{handleScroll(){if(!this.hasMore)return;const t=this.$el.getBoundingClientRect().top-window.innerHeight;t<this.threshold&&!this.loading&&(this.loading=!0,this.loadMore((()=>{this.loading=!1})))}}},L=S,Y=(0,u.Z)(L,I,k,!1,null,null,null),D=Y.exports,P=a(4561),Z=a(1873),R=a(3022),E={name:"Home",components:{PageHeader:f,ImageCard:C,ImageModal:P.Z,Loading:Z.Z,PullToRefresh:T,InfiniteScroll:D},created(){this.fetchData()},data(){return{imageList:[],currentIndex:0,showModal:!1,loading:!0,total:0,pageInfo:{pageNumber:1,pageSize:5}}},computed:{hasMore(){return this.imageList.length<this.total}},methods:{getData(){return new Promise(((t,e)=>{(0,R.pd)(this.pageInfo).then((({data:e})=>{t(e)})).catch(e)}))},async fetchData(){try{this.loading=!0;const{files:t,count:e}=await this.getData();this.total=e,this.imageList=t}catch(t){console.log(t)}finally{this.loading=!1}},async refresh(){try{this.pageInfo.pageNumber=1;const{files:t,count:e}=await this.getData();this.total=e,this.imageList=t}catch(t){console.log(t)}},async loadMoreData(t){if(this.hasMore)try{this.pageInfo.pageNumber++;const{files:e,count:a}=await this.getData();this.total=a,this.imageList.push(...e),o().isFunction(t)&&t()}catch(e){this.pageInfo.pageNumber--,console.log(e)}},handleClick(t){this.showModal=!0;const e=o().findIndex(this.imageList,t);this.currentIndex=e}}},N=E,H=(0,u.Z)(N,n,s,!1,null,"43fbd661",null),$=H.exports}}]);